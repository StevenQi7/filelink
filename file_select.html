<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FileLink - 文件选择</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'SF Pro Display', system-ui, sans-serif;
            background-color: #F2F2F7;
            color: #1D1D1F;
            line-height: 1.5;
            height: 100vh;
            display: flex;
            flex-direction: column;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow: hidden;
        }
        
        /* iOS 状态栏 */
        .ios-status-bar {
            height: 36px;
            width: 100%;
            background-color: #F2F2F7;
            padding: 0 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .status-bar-time {
            font-weight: 600;
            font-size: 15px;
        }
        
        .status-bar-icons {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .status-bar-icons i {
            font-size: 14px;
        }
        
        /* iOS 导航栏 */
        .ios-nav-bar {
            height: 44px;
            padding: 0 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: rgba(242, 242, 247, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            position: sticky;
            top: 36px;
            z-index: 90;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .back-button {
            display: flex;
            align-items: center;
            color: #007AFF;
            font-size: 17px;
            padding: 8px 0;
        }
        
        .back-button i {
            margin-right: 4px;
            font-size: 16px;
        }
        
        .font-semibold {
            font-weight: 600;
        }
        
        /* 主内容区 */
        .content-area {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding-bottom: calc(16px + env(safe-area-inset-bottom) + 83px);
        }
        
        @supports not (padding: env(safe-area-inset-bottom)) {
            .content-area {
                padding-bottom: 99px; /* 16px + 83px */
            }
        }
        
        /* 页面标题 */
        .page-header {
            margin-bottom: 20px;
            text-align: center;
        }
        
        .page-title {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 6px;
            color: #1D1D1F;
        }
        
        .page-subtitle {
            font-size: 15px;
            color: #8E8E93;
        }
        
        /* 文件选择按钮 */
        .file-select-button {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #007AFF;
            color: white;
            font-weight: 600;
            font-size: 16px;
            padding: 14px 0;
            border-radius: 14px;
            border: none;
            cursor: pointer;
            width: 100%;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.25);
            transition: all 0.2s ease;
            height: 50px;
        }
        
        .file-select-button:active {
            background-color: #0062CC;
            transform: scale(0.98);
        }
        
        .file-select-button i {
            margin-right: 10px;
            font-size: 18px;
        }
        
        .file-input {
            display: none;
        }
        
        /* 文件列表 */
        .file-list-section {
            margin-bottom: 20px;
            background-color: white;
            border-radius: 16px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }
        
        .file-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid #F2F2F7;
        }
        
        .file-list-title {
            font-size: 17px;
            font-weight: 600;
            color: #1D1D1F;
        }
        
        .clear-button {
            color: #FF3B30;
            font-size: 15px;
            font-weight: 600;
            padding: 8px 12px;
            border-radius: 10px;
            transition: all 0.2s ease;
        }
        
        .clear-button:active {
            background-color: rgba(255, 59, 48, 0.1);
            transform: scale(0.97);
        }
        
        .empty-list-message {
            text-align: center;
            color: #8E8E93;
            font-size: 15px;
            padding: 40px 0;
            background-color: white;
        }
        
        /* 文件项 */
        .file-item {
            display: flex;
            align-items: center;
            padding: 14px 16px;
            background-color: white;
            border-bottom: 1px solid #F2F2F7;
            transition: all 0.2s ease;
            animation: file-appear 0.3s ease-out;
        }
        
        .file-item:last-child {
            border-bottom: none;
        }
        
        .file-icon {
            width: 48px;
            height: 48px;
            background-color: #F5F5F7;
            border-radius: 12px;
            margin-right: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
        }
        
        .file-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .file-icon i {
            font-size: 22px;
            color: #8E8E93;
        }
        
        /* 文件类型标识 */
        .file-type-badge {
            position: absolute;
            bottom: -4px;
            right: -4px;
            width: 20px;
            height: 20px;
            border-radius: 10px;
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .file-type-badge i {
            font-size: 10px;
        }
        
        /* 文件类型颜色 */
        .file-icon-pdf {
            background-color: rgba(255, 59, 48, 0.08);
        }
        
        .file-icon-pdf i {
            color: #FF3B30;
        }
        
        .file-icon-doc {
            background-color: rgba(0, 122, 255, 0.08);
        }
        
        .file-icon-doc i {
            color: #007AFF;
        }
        
        .file-icon-img {
            background-color: rgba(94, 92, 230, 0.08);
        }
        
        .file-icon-img i {
            color: #5E5CE6;
        }
        
        .file-icon-video {
            background-color: rgba(255, 149, 0, 0.08);
        }
        
        .file-icon-video i {
            color: #FF9500;
        }
        
        .file-icon-audio {
            background-color: rgba(191, 90, 242, 0.08);
        }
        
        .file-icon-audio i {
            color: #BF5AF2;
        }
        
        .file-icon-zip {
            background-color: rgba(88, 86, 214, 0.08);
        }
        
        .file-icon-zip i {
            color: #5856D6;
        }
        
        .file-icon-code {
            background-color: rgba(52, 199, 89, 0.08);
        }
        
        .file-icon-code i {
            color: #34C759;
        }
        
        .file-icon-excel {
            background-color: rgba(48, 209, 88, 0.08);
        }
        
        .file-icon-excel i {
            color: #30D158;
        }
        
        .file-icon-ppt {
            background-color: rgba(255, 69, 58, 0.08);
        }
        
        .file-icon-ppt i {
            color: #FF453A;
        }
        
        .file-icon-text {
            background-color: rgba(142, 142, 147, 0.08);
        }
        
        .file-icon-text i {
            color: #8E8E93;
        }
        
        .file-details {
            flex: 1;
            overflow: hidden;
        }
        
        .file-name {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px;
            color: #1D1D1F;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .file-info {
            display: flex;
            align-items: center;
            font-size: 13px;
            color: #8E8E93;
        }
        
        .file-type-tag {
            background-color: #F5F5F7;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 8px;
            font-size: 11px;
            font-weight: 600;
            color: #8E8E93;
        }
        
        .file-delete {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #FF3B30;
            margin-left: 10px;
            transition: all 0.2s ease;
        }
        
        .file-delete:active {
            background-color: rgba(255, 59, 48, 0.1);
            transform: scale(0.95);
        }
        
        /* 操作按钮 */
        .action-buttons {
            display: flex;
            justify-content: space-between;
            gap: 12px;
            margin-top: auto;
        }
        
        .cancel-button {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 50px;
            background-color: #F5F5F7;
            border: none;
            border-radius: 14px;
            color: #1D1D1F;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        
        .cancel-button:active {
            background-color: #E5E5EA;
            transform: scale(0.98);
        }
        
        .send-button {
            flex: 2;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 50px;
            background-color: #FF3B30;
            border: none;
            border-radius: 14px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.2s ease;
            box-shadow: 0 4px 12px rgba(255, 59, 48, 0.25);
        }
        
        .send-button:active {
            background-color: #D70015;
            transform: scale(0.98);
        }
        
        .send-button i {
            margin-right: 8px;
            font-size: 16px;
        }
        
        /* 图片预览项 */
        .image-preview-item {
            display: flex;
            align-items: center;
            padding: 14px 16px;
            background-color: white;
            border-bottom: 1px solid #F2F2F7;
            transition: all 0.2s ease;
            animation: file-appear 0.3s ease-out;
        }
        
        .image-preview-item:last-child {
            border-bottom: none;
        }
        
        .image-preview {
            width: 64px;
            height: 64px;
            border-radius: 12px;
            margin-right: 14px;
            overflow: hidden;
            position: relative;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
        }
        
        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .image-type-badge {
            position: absolute;
            bottom: 8px;
            right: 8px;
            padding: 4px 8px;
            background-color: rgba(0, 0, 0, 0.6);
            color: white;
            border-radius: 10px;
            font-size: 11px;
            display: flex;
            align-items: center;
        }
        
        .image-type-badge i {
            margin-right: 4px;
            font-size: 10px;
        }
        
        .image-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .image-info {
            font-size: 13px;
            color: #8E8E93;
            display: flex;
            align-items: center;
        }
        
        /* iOS 标签栏 */
        .ios-tab-bar {
            height: calc(50px + env(safe-area-inset-bottom));
            width: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-around;
            align-items: center;
            position: fixed;
            bottom: 0;
            z-index: 100;
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        @supports not (padding-bottom: env(safe-area-inset-bottom)) {
            .ios-tab-bar {
                height: 83px; /* 50px + 33px (typical safe area) */
                padding-bottom: 33px;
            }
        }
        
        .tab-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 50px;
            color: #8E8E93;
            font-size: 10px;
        }
        
        .tab-item i {
            font-size: 22px;
            margin-bottom: 2px;
        }
        
        .tab-item.active {
            color: #007AFF;
        }
        
        /* 通知徽章 */
        .notification-badge {
            position: absolute;
            top: 0;
            right: 30%;
            background-color: #FF3B30;
            color: white;
            font-size: 10px;
            width: 18px;
            height: 18px;
            border-radius: 9px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }
        
        /* 轻弹窗提示 */
        .toast {
            position: fixed;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            background-color: rgba(0, 0, 0, 0.75);
            color: white;
            padding: 12px 20px;
            border-radius: 24px;
            font-size: 14px;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, transform 0.3s ease;
            z-index: 100;
        }
        
        .toast.active {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
        }
        
        /* 通知系统 */
        .notification-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 200;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 90px;
        }

        .notification-popup {
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            width: 90%;
            max-width: 360px;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            margin-bottom: 12px;
            overflow: hidden;
            transform: translateY(-20px);
            opacity: 0;
            pointer-events: auto;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .notification-popup.active {
            transform: translateY(0);
            opacity: 1;
        }

        .notification-header {
            display: flex;
            align-items: center;
            padding: 14px 16px 8px;
        }

        .notification-app-icon {
            width: 28px;
            height: 28px;
            border-radius: 8px;
            background-color: #007AFF;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-size: 14px;
        }

        .notification-app-name {
            font-weight: 600;
            font-size: 15px;
            color: #1D1D1F;
        }

        .notification-time {
            font-size: 13px;
            color: #8E8E93;
            margin-left: auto;
        }

        .notification-content {
            padding: 0 16px 14px;
        }

        .notification-title {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 4px;
            color: #1D1D1F;
        }

        .notification-message {
            font-size: 14px;
            margin-bottom: 14px;
            color: #3A3A3C;
            line-height: 1.4;
        }

        .notification-file-info {
            display: flex;
            align-items: center;
            background-color: #F2F2F7;
            padding: 10px 12px;
            border-radius: 12px;
            margin-bottom: 14px;
        }

        .notification-file-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            color: #007AFF;
            font-size: 20px;
        }

        .notification-file-details {
            flex: 1;
        }

        .notification-file-name {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 240px;
            color: #1D1D1F;
        }

        .notification-file-size {
            font-size: 12px;
            color: #8E8E93;
        }

        .notification-actions {
            display: flex;
            border-top: 1px solid #E5E5EA;
        }

        .notification-action-button {
            flex: 1;
            padding: 14px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 15px;
            transition: background-color 0.2s ease;
        }

        .notification-action-button:active {
            background-color: #F2F2F7;
        }

        .notification-action-button.accept {
            color: #007AFF;
            border-right: 1px solid #E5E5EA;
        }

        .notification-action-button.decline {
            color: #FF3B30;
        }
    </style>
</head>
<body>
    <!-- iOS 状态栏 -->
    <div class="ios-status-bar">
        <div class="status-bar-time" id="statusBarTime">9:41</div>
        <div class="status-bar-icons">
            <i class="fas fa-signal"></i>
            <i class="fas fa-wifi"></i>
            <i class="fas fa-battery-full"></i>
        </div>
    </div>
    
    <!-- iOS 导航栏 -->
    <div class="ios-nav-bar">
        <div class="back-button" onclick="goBack()">
            <i class="fas fa-chevron-left"></i>
            <span>返回</span>
        </div>
        <div class="font-semibold">选择文件</div>
        <div style="width: 60px;"></div> <!-- 占位以保持标题居中 -->
    </div>
    
    <!-- 主内容区 -->
    <div class="content-area">
        <div class="page-header">
            <div class="page-title">选择要发送的文件</div>
            <div class="page-subtitle">可以选择多个文件同时发送</div>
        </div>
        
        <!-- 文件选择按钮 -->
        <label for="fileInput" class="file-select-button">
            <i class="fas fa-plus"></i>
            <span>选择文件</span>
        </label>
        <input type="file" id="fileInput" class="file-input" multiple>
        
        <!-- 文件列表 -->
        <div class="file-list-section">
            <div class="file-list-header">
                <div class="file-list-title" id="fileCounter">已选择文件 (0)</div>
                <div class="clear-button" id="clearButton">清空</div>
            </div>
            
            <div id="fileList">
                <div class="empty-list-message" id="emptyMessage">还没有选择文件</div>
                <!-- 文件项将通过 JavaScript 动态生成 -->
            </div>
        </div>
        
        <!-- 操作按钮 -->
        <div class="action-buttons">
            <button class="cancel-button" onclick="goBack()">取消</button>
            <button class="send-button" id="sendButton" onclick="sendFiles()">
                <i class="fas fa-paper-plane"></i>
                <span>发送</span>
            </button>
        </div>
    </div>
    
    <!-- iOS 标签栏 -->
    <div class="ios-tab-bar">
        <div class="tab-item active" onclick="navigateTo('home.html')">
            <i class="fas fa-home"></i>
            <span>主页</span>
        </div>
        <div class="tab-item" onclick="navigateTo('history.html')">
            <i class="fas fa-history"></i>
            <span>历史</span>
        </div>
        <div class="tab-item" onclick="navigateTo('settings.html')">
            <i class="fas fa-cog"></i>
            <span>设置</span>
        </div>
    </div>
    
    <!-- 轻弹窗提示 -->
    <div class="toast" id="toast">操作成功</div>
    
    <!-- 通知系统 -->
    <div class="notification-container" id="notificationContainer">
        <!-- 通知将在这里动态生成 -->
    </div>
    
    <script>
        // 页面初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 更新时间
            updateTime();
            setInterval(updateTime, 60000); // 每分钟更新一次时间
            
            // 初始化文件选择
            initFileSelection();
            
            // 初始化清空按钮
            document.getElementById('clearButton').addEventListener('click', clearAllFiles);
            
            // 初始状态设置
            updateSendButtonState();
            
            // 模拟接收文件请求通知（仅供演示）
            setTimeout(() => {
                showFileRequestNotification({
                    sender: '王小明的 iPhone',
                    fileName: '会议记录.docx',
                    fileSize: '2.4 MB',
                    fileType: 'doc'
                });
            }, 3000);
        });
        
        // 更新状态栏时间
        function updateTime() {
            const now = new Date();
            let hours = now.getHours();
            let minutes = now.getMinutes();
            if (minutes < 10) minutes = '0' + minutes;
            document.getElementById('statusBarTime').textContent = hours + ':' + minutes;
        }
        
        // 初始化文件选择
        function initFileSelection() {
            const fileInput = document.getElementById('fileInput');
            
            fileInput.addEventListener('change', function(e) {
                handleFiles(e.target.files);
            });
        }
        
        // 处理选择的文件
        function handleFiles(files) {
            if (files.length === 0) return;
            
            // 隐藏空列表消息
            document.getElementById('emptyMessage').style.display = 'none';
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const fileId = 'file_' + Date.now() + '_' + i;
                
                // 创建文件项元素
                const fileElement = createFileElement(file, fileId);
                
                // 添加到文件列表
                document.getElementById('fileList').appendChild(fileElement);
            }
            
            // 更新文件计数和发送按钮状态
            updateFileCount();
            updateSendButtonState();
            
            // 显示提示
            showToast(`已添加 ${files.length} 个文件`);
        }
        
        // 创建文件项元素
        function createFileElement(file, fileId) {
            // 判断文件类型和扩展名
            let fileIconClass = '';
            let fileIcon = '';
            let isImage = false;
            let fileTypeText = '';
            let fileExtension = file.name.split('.').pop().toLowerCase();
            
            // 图片类型
            if (file.type.startsWith('image/')) {
                isImage = true;
                fileIconClass = 'file-icon-img';
                fileIcon = '<i class="far fa-image"></i>';
                fileTypeText = file.type.split('/')[1].toUpperCase();
                if (fileTypeText === 'JPEG') fileTypeText = 'JPG';
            } 
            // PDF 文件
            else if (file.type.includes('pdf') || fileExtension === 'pdf') {
                fileIconClass = 'file-icon-pdf';
                fileIcon = '<i class="far fa-file-pdf"></i>';
                fileTypeText = 'PDF';
            } 
            // Word 文档
            else if (file.type.includes('word') || file.type.includes('document') || 
                    fileExtension === 'doc' || fileExtension === 'docx') {
                fileIconClass = 'file-icon-doc';
                fileIcon = '<i class="far fa-file-word"></i>';
                fileTypeText = fileExtension.toUpperCase();
            } 
            // Excel 文件
            else if (file.type.includes('spreadsheet') || file.type.includes('excel') || 
                    fileExtension === 'xls' || fileExtension === 'xlsx') {
                fileIconClass = 'file-icon-excel';
                fileIcon = '<i class="far fa-file-excel"></i>';
                fileTypeText = fileExtension.toUpperCase();
            } 
            // PowerPoint 文件
            else if (file.type.includes('presentation') || 
                    fileExtension === 'ppt' || fileExtension === 'pptx') {
                fileIconClass = 'file-icon-ppt';
                fileIcon = '<i class="far fa-file-powerpoint"></i>';
                fileTypeText = fileExtension.toUpperCase();
            } 
            // 视频文件
            else if (file.type.includes('video') || 
                    ['mp4', 'mov', 'avi', 'mkv', 'wmv'].includes(fileExtension)) {
                fileIconClass = 'file-icon-video';
                fileIcon = '<i class="far fa-file-video"></i>';
                fileTypeText = fileExtension.toUpperCase();
            } 
            // 音频文件
            else if (file.type.includes('audio') || 
                    ['mp3', 'wav', 'ogg', 'flac', 'm4a'].includes(fileExtension)) {
                fileIconClass = 'file-icon-audio';
                fileIcon = '<i class="far fa-file-audio"></i>';
                fileTypeText = fileExtension.toUpperCase();
            } 
            // 压缩文件
            else if (['zip', 'rar', '7z', 'tar', 'gz'].includes(fileExtension)) {
                fileIconClass = 'file-icon-zip';
                fileIcon = '<i class="far fa-file-archive"></i>';
                fileTypeText = fileExtension.toUpperCase();
            } 
            // 代码文件
            else if (['html', 'css', 'js', 'java', 'py', 'php', 'c', 'cpp', 'h', 'json', 'xml'].includes(fileExtension)) {
                fileIconClass = 'file-icon-code';
                fileIcon = '<i class="far fa-file-code"></i>';
                fileTypeText = fileExtension.toUpperCase();
            } 
            // 文本文件
            else if (['txt', 'md', 'rtf'].includes(fileExtension)) {
                fileIconClass = 'file-icon-text';
                fileIcon = '<i class="far fa-file-alt"></i>';
                fileTypeText = fileExtension.toUpperCase();
            } 
            // 默认文件类型
            else {
                fileIcon = '<i class="far fa-file"></i>';
                fileTypeText = fileExtension.toUpperCase();
            }
            
            // 格式化文件大小
            const fileSize = formatFileSize(file.size);
            
            // 创建元素
            const element = document.createElement('div');
            
            // 为图片文件创建特殊预览
            if (isImage && window.FileReader) {
                element.className = 'image-preview-item';
                element.dataset.fileId = fileId;
                
                // 临时显示占位内容
                element.innerHTML = `
                    <div class="image-preview">
                        <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background-color: #F5F5F7;">
                            <i class="far fa-image" style="font-size: 24px; color: #8E8E93;"></i>
                        </div>
                    </div>
                    <div class="file-details">
                        <div class="file-name">${file.name}</div>
                        <div class="file-info">
                            <span>${fileSize}</span>
                            <span class="file-type-tag">${fileTypeText}</span>
                        </div>
                    </div>
                    <div class="file-delete" onclick="removeFile('${fileId}')">
                        <i class="fas fa-times"></i>
                    </div>
                `;
                
                // 创建文件阅读器并加载图片
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imgPreview = element.querySelector('.image-preview');
                    imgPreview.innerHTML = `<img src="${e.target.result}" alt="${file.name}">`;
                };
                reader.readAsDataURL(file);
            } else {
                // 创建标准文件项
                element.className = 'file-item';
                element.dataset.fileId = fileId;
                
                element.innerHTML = `
                    <div class="file-icon ${fileIconClass}">
                        ${fileIcon}
                    </div>
                    <div class="file-details">
                        <div class="file-name">${file.name}</div>
                        <div class="file-info">
                            <span>${fileSize}</span>
                            <span class="file-type-tag">${fileTypeText}</span>
                        </div>
                    </div>
                    <div class="file-delete" onclick="removeFile('${fileId}')">
                        <i class="fas fa-times"></i>
                    </div>
                `;
            }
            
            return element;
        }
        
        // 获取文件类型的图标
        function getFileTypeIcon(extension) {
            const iconMap = {
                'pdf': 'file-pdf',
                'doc': 'file-word', 'docx': 'file-word',
                'xls': 'file-excel', 'xlsx': 'file-excel',
                'ppt': 'file-powerpoint', 'pptx': 'file-powerpoint',
                'jpg': 'image', 'jpeg': 'image', 'png': 'image', 'gif': 'image', 'svg': 'image',
                'mp4': 'video', 'mov': 'video', 'avi': 'video', 'mkv': 'video',
                'mp3': 'music', 'wav': 'music', 'ogg': 'music',
                'zip': 'archive', 'rar': 'archive', '7z': 'archive',
                'html': 'code', 'css': 'code', 'js': 'code', 'py': 'code', 'php': 'code'
            };
            
            return iconMap[extension.toLowerCase()] || 'file';
        }
        
        // 删除文件
        function removeFile(fileId) {
            const fileElement = document.querySelector(`[data-file-id="${fileId}"]`);
            if (!fileElement) return;
            
            // 添加删除动画
            fileElement.classList.add('removing');
            
            // 动画完成后删除元素
            setTimeout(() => {
                fileElement.remove();
                updateFileCount();
                updateSendButtonState();
                
                // 如果没有文件了，显示空列表消息
                const fileList = document.getElementById('fileList');
                if (fileList.children.length === 1) {
                    document.getElementById('emptyMessage').style.display = 'block';
                }
            }, 300);
            
            showToast('已删除文件');
        }
        
        // 清空所有文件
        function clearAllFiles() {
            const fileItems = document.querySelectorAll('#fileList .file-item, #fileList .image-preview-item');
            if (fileItems.length === 0) return;
            
            // 依次添加删除动画
            fileItems.forEach((item, index) => {
                setTimeout(() => {
                    item.classList.add('removing');
                }, index * 50);
            });
            
            // 等待所有动画完成后清空列表
            setTimeout(() => {
                fileItems.forEach(item => item.remove());
                updateFileCount();
                updateSendButtonState();
                document.getElementById('emptyMessage').style.display = 'block';
            }, fileItems.length * 50 + 300);
            
            showToast('已清空所有文件');
        }
        
        // 更新文件计数
        function updateFileCount() {
            const fileItems = document.querySelectorAll('#fileList .file-item, #fileList .image-preview-item');
            document.getElementById('fileCounter').textContent = `已选择文件 (${fileItems.length})`;
        }
        
        // 更新发送按钮状态
        function updateSendButtonState() {
            const fileItems = document.querySelectorAll('#fileList .file-item, #fileList .image-preview-item');
            const sendButton = document.getElementById('sendButton');
            
            if (fileItems.length === 0) {
                sendButton.disabled = true;
                sendButton.style.opacity = '0.5';
                sendButton.style.cursor = 'default';
            } else {
                sendButton.disabled = false;
                sendButton.style.opacity = '1';
                sendButton.style.cursor = 'pointer';
            }
        }
        
        // 发送文件
        function sendFiles() {
            const fileItems = document.querySelectorAll('#fileList .file-item, #fileList .image-preview-item');
            
            if (fileItems.length === 0) {
                showToast('请先选择文件');
                return;
            }
            
            showToast(`正在发送 ${fileItems.length} 个文件...`);
            
            // 模拟发送过程
            setTimeout(() => {
                window.location.href = 'transfer.html';
            }, 1000);
        }
        
        // 格式化文件大小
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }
        
        // 显示提示
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('active');
            
            setTimeout(() => {
                toast.classList.remove('active');
            }, 2000);
        }
        
        // 显示文件请求通知
        function showFileRequestNotification(data) {
            const notificationId = 'notification_' + Date.now();
            const notificationContainer = document.getElementById('notificationContainer');
            
            // 确定文件图标
            let fileIcon = 'fa-file';
            if (data.fileType === 'pdf') fileIcon = 'fa-file-pdf';
            else if (data.fileType === 'doc' || data.fileType === 'docx') fileIcon = 'fa-file-word';
            else if (data.fileType === 'xls' || data.fileType === 'xlsx') fileIcon = 'fa-file-excel';
            else if (data.fileType === 'ppt' || data.fileType === 'pptx') fileIcon = 'fa-file-powerpoint';
            else if (data.fileType === 'jpg' || data.fileType === 'png' || data.fileType === 'gif') fileIcon = 'fa-image';
            else if (data.fileType === 'mp4' || data.fileType === 'mov') fileIcon = 'fa-file-video';
            else if (data.fileType === 'mp3' || data.fileType === 'wav') fileIcon = 'fa-file-audio';
            else if (data.fileType === 'zip' || data.fileType === 'rar') fileIcon = 'fa-file-archive';
            
            // 创建通知元素
            const notification = document.createElement('div');
            notification.className = 'notification-popup';
            notification.id = notificationId;
            
            notification.innerHTML = `
                <div class="notification-header">
                    <div class="notification-app-icon">
                        <i class="fas fa-link"></i>
                    </div>
                    <div class="notification-app-name">FileLink</div>
                    <div class="notification-time">现在</div>
                </div>
                <div class="notification-content">
                    <div class="notification-title">接收文件请求</div>
                    <div class="notification-message">${data.sender} 想要向您发送文件:</div>
                    <div class="notification-file-info">
                        <div class="notification-file-icon">
                            <i class="far ${fileIcon}"></i>
                        </div>
                        <div class="notification-file-details">
                            <div class="notification-file-name">${data.fileName}</div>
                            <div class="notification-file-size">${data.fileSize}</div>
                        </div>
                    </div>
                </div>
                <div class="notification-actions">
                    <div class="notification-action-button accept" onclick="acceptFileRequest('${notificationId}')">
                        接收
                    </div>
                    <div class="notification-action-button decline" onclick="declineFileRequest('${notificationId}')">
                        拒绝
                    </div>
                </div>
            `;
            
            // 添加到容器并显示
            notificationContainer.appendChild(notification);
            
            // 添加声音效果
            const audio = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-software-interface-start-2574.mp3');
            audio.volume = 0.5;
            audio.play().catch(e => console.log('播放声音失败:', e));
            
            // 设置短暂延迟后显示
            setTimeout(() => {
                notification.classList.add('active');
            }, 100);
            
            // 如果没有操作，10秒后自动隐藏
            setTimeout(() => {
                if (document.getElementById(notificationId)) {
                    notification.classList.remove('active');
                    setTimeout(() => {
                        notification.remove();
                    }, 300);
                }
            }, 10000);
        }
        
        // 接受文件请求
        function acceptFileRequest(notificationId) {
            const notification = document.getElementById(notificationId);
            if (!notification) return;
            
            notification.classList.remove('active');
            setTimeout(() => {
                notification.remove();
                showToast('已接受文件请求');
                
                // 这里应该跳转到接收文件的页面
                // window.location.href = 'waiting_receive.html';
                
                // 模拟跳转（仅供演示）
                setTimeout(() => {
                    showToast('准备接收文件中...');
                }, 1000);
            }, 300);
        }
        
        // 拒绝文件请求
        function declineFileRequest(notificationId) {
            const notification = document.getElementById(notificationId);
            if (!notification) return;
            
            notification.classList.remove('active');
            setTimeout(() => {
                notification.remove();
                showToast('已拒绝文件请求');
            }, 300);
        }
        
        // 返回上一页
        function goBack() {
            window.history.back();
        }
    </script>
</body>
</html> 
